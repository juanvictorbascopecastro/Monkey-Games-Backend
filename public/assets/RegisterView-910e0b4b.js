import{K as Q,_ as R,r as a,o as m,e as D,w as o,a as e,b as l,d as n,c as g,i as H,F,t as p,j as T,L as j,M as q,N as W,m as X,O as Y,S as A,k as Z,I as tt,P as K,Q as et,l as st}from"./index-2006f269.js";import{a as ot,c as nt,b as x,d as at,s as it}from"./format-date-ea6389fa.js";import{w as lt,c as ct,m as rt,v as dt}from"./phone-dd19b05b.js";import{I as ut,A as mt}from"./AddVenta-d6268a51.js";import{g as _t}from"./sockets-c31589a8.js";import"./picture-093c9837.js";import"./Paginador-8381f521.js";import"./user-account-441e03f2.js";import"./AddClient-421475f7.js";import"./input-45862cdb.js";import"./InputPhone-560f6b25.js";const pt={emits:["visible"],props:{visible:{type:Boolean,default:!1},data:{type:Object,default:null}},data(){return{list:[],isLoading:!1}},methods:{...Q("register",["loadHistory"]),getTime:ot,convertDate:nt,whatsapp:lt,call:ct,mail:rt},watch:{visible:{immediate:!0,async handler(t){t&&this.data&&(this.list=await this.loadHistory(this.data.id))}}},components:{vueQr:dt}},ht=t=>(j("data-v-ba21148e"),t=t(),q(),t),Ct={class:"row g-3"},ft={class:"col-12 col-md-8 col-xl-9"},gt=ht(()=>n("h6",null,"No hay registros!",-1)),vt={class:"col-12 col-md-4 col-xl-3"},bt={class:"card-user"},yt={class:"code"},wt={class:"nombre"},Dt={key:0,class:"detalle text-end"};function $t(t,s,u,w,i,r){const c=a("CModalTitle"),d=a("CModalHeader"),C=a("CTableHeaderCell"),v=a("CTableRow"),b=a("CTableHead"),h=a("CTableDataCell"),$=a("CBadge"),k=a("CTableBody"),f=a("CSpinner"),L=a("CTable"),V=a("vue-qr"),S=a("CIcon"),I=a("CButton"),E=a("CModalBody"),M=a("CModalFooter"),_=a("CModal");return m(),D(_,{alignment:"center",visible:u.visible,backdrop:"static",size:"xl",onClose:s[4]||(s[4]=()=>{t.$emit("visible",!1)})},{default:o(()=>[e(d,null,{default:o(()=>[e(c,null,{default:o(()=>[l("HISTORIAL DE REGISTRO ")]),_:1})]),_:1}),e(E,null,{default:o(()=>{var B,O,z,G;return[n("div",Ct,[n("div",ft,[e(L,{responsive:"",size:"sm"},{default:o(()=>[e(b,null,{default:o(()=>[e(v,null,{default:o(()=>[e(C,{scope:"col"},{default:o(()=>[l("Fecha ingreso")]),_:1}),e(C,{scope:"col"},{default:o(()=>[l("Tiempo solicitado")]),_:1}),e(C,{scope:"col"},{default:o(()=>[l("Tiempo ocupado")]),_:1}),e(C,{scope:"col"},{default:o(()=>[l("Descripción")]),_:1}),e(C,{scope:"col"},{default:o(()=>[l("Estado")]),_:1}),e(C,{scope:"col"},{default:o(()=>[l("Usuario")]),_:1})]),_:1})]),_:1}),i.list.length>0?(m(),D(k,{key:0},{default:o(()=>[(m(!0),g(F,null,H(i.list,(y,J)=>(m(),D(v,{key:J},{default:o(()=>[e(h,null,{default:o(()=>[l(p(r.convertDate(y.date)),1)]),_:2},1024),e(h,null,{default:o(()=>[l(p(y.minutes)+" min",1)]),_:2},1024),e(h,null,{default:o(()=>[l(p(r.getTime(y)),1)]),_:2},1024),e(h,null,{default:o(()=>[l(p(y.description),1)]),_:2},1024),e(h,null,{default:o(()=>[y.status?(m(),D($,{key:1,color:"secondary"},{default:o(()=>[l("Finalizado")]),_:1})):(m(),D($,{key:0,color:"success"},{default:o(()=>[l(" En curso")]),_:1}))]),_:2},1024),e(h,{scope:"row"},{default:o(()=>{var U,P;return[l(p((U=y.User)==null?void 0:U.name)+" "+p((P=y.User)==null?void 0:P.lastName),1)]}),_:2},1024)]),_:2},1024))),128))]),_:1})):i.isLoading?(m(),D(k,{key:1},{default:o(()=>[e(v,null,{default:o(()=>[e(h,{colspan:"7",class:"text-center p-4"},{default:o(()=>[e(f,{color:"primary"})]),_:1})]),_:1})]),_:1})):(m(),D(k,{key:2},{default:o(()=>[e(v,null,{default:o(()=>[e(h,{colspan:"7",class:"text-center p-4"},{default:o(()=>[gt]),_:1})]),_:1})]),_:1}))]),_:1})]),n("div",vt,[n("div",bt,[e(V,{text:(B=u.data)==null?void 0:B.code,size:150},null,8,["text"]),n("div",yt,"Codigo: "+p((O=u.data)==null?void 0:O.code),1),n("div",wt,p((z=u.data)==null?void 0:z.name)+" "+p(((G=u.data)==null?void 0:G.lastName)||""),1),u.data.phone?(m(),g("div",Dt,[e(I,{color:"success",class:"ms-2 btn-social",onClick:s[0]||(s[0]=y=>r.whatsapp(u.data.phone))},{default:o(()=>[e(S,{icon:"cib-whatsapp",height:"22"})]),_:1}),e(I,{color:"secondary",class:"ms-2 btn-social",onClick:s[1]||(s[1]=y=>r.call(u.data.phone))},{default:o(()=>[e(S,{icon:"cil-phone",height:"22"})]),_:1}),e(I,{color:"info",class:"ms-2 btn-social",onClick:s[2]||(s[2]=y=>r.mail(u.data.phone))},{default:o(()=>[e(S,{icon:"cil-envelope-closed",height:"22"})]),_:1})])):T("",!0)])])])]}),_:1}),e(M,null,{default:o(()=>[e(I,{color:"primary",type:"button",onClick:s[3]||(s[3]=B=>t.$emit("visible",!1))},{default:o(()=>[l(" Aceptar ")]),_:1})]),_:1})]),_:1},8,["visible"])}const kt=R(pt,[["render",$t],["__scopeId","data-v-ba21148e"]]);const It={props:{data:{type:Object,default:null}},emits:["setData"],data(){return{COIN:W,inputData:{description:null,time:x(new Date().setSeconds(new Date().getSeconds()+20)),minutes:20},client:null,socketClientCode:null,validateForm:null,showModal:!1}},computed:{...X("price",["list","isLoading"]),getClass(){if(!this.data)return"";const t=this.getMinutesRestante(this.data);return t>=0?t<=2?"bg-warning-tr":"bg-success-tr":"bg-danger-tr"},getPrice(){const t=this.list.find(s=>s.minutes===parseFloat(this.inputData.minutes));return t?t.price:0}},methods:{getSocket:_t,getMinutesRestante:at,async Validate(t){t.preventDefault(),t.currentTarget.checkValidity()===!1&&(t.preventDefault(),t.stopPropagation()),this.validateForm=!0,this.inputData.time&&this.inputData.minutes&&this.preguntar()},preguntar(){if(!this.$store.state.caja.caja){Y("warning");return}this.$store.state.caja.caja.idOpened?this.saving():A.fire({title:"No se ha efectuado la apertura de caja ¿Desea continuar?",icon:"question",showCancelButton:!0,confirmButtonColor:"#321fdb",cancelButtonColor:"#bdbdbd",confirmButtonText:"ACEPTAR",cancelButtonText:"CANCELAR"}).then(async t=>{t.isConfirmed&&this.saving()})},async saving(){var i;const t=this.inputData.time.split(":"),s=new Date;s.setHours(t[0]),s.setMinutes(t[1]);const u={date:s,minutes:this.inputData.minutes,description:this.inputData.description};this.client&&(u.idClients=(i=this.client)==null?void 0:i.id);let w;this.data?w=await this.$store.dispatch("register/update",{id:this.data.id,...u}):w=await this.$store.dispatch("register/create",u),w&&(this.getSocket()&&this.socketClientCode&&(this.getSocket().emit(Z,this.socketClientCode,r=>this.$store.state.socket.qrRead=r),this.$store.state.socket.clientNew=null),this.validateForm=!1,this.setData(null))},changueFocus(t){const s=element("form-ingreso",t);s&&s.focus()},setData(t=null){if(!t){this.$router.replace({name:"control-tiempos"}),this.socketClientCode=null,this.inputData.description=null,this.inputData.time=x(new Date().setSeconds(new Date().getSeconds()+20)),this.client=null,this.$emit("setData",null);return}this.inputData.description=t.description,this.inputData.time=x(new Date(t.date)),this.inputData.minutes=t.minutes,t.Client?this.client=t.Client:this.client=null},async endData(){if(this.getMinutesRestante(this.data)<0){await this.$store.dispatch("register/endRegister",this.data.id)&&this.setData();return}A.fire({title:"¿Desea concluir este registro?",text:"No ha llegado todavía al tiempo límite!",icon:"question",showCancelButton:!0,confirmButtonColor:"#2eb85c",cancelButtonColor:"#bdbdbd",confirmButtonText:"CONCLUIR",cancelButtonText:"CANCELAR"}).then(async s=>{s.isConfirmed&&this.$store.dispatch("register/endRegister",this.data.id)&&this.setData()})},setClientFromSocket(t){this.socketClientCode=t.codeEmit,this.client=t.client,this.$store.state.socket.clientNew=null},async searchCode(){let t;this.$store.state.socket.qrRead.length>0>0&&this.$route.query.code&&(t=this.$store.getters["socket/getClietQr"](this.$route.query.code),t&&this.setClientFromSocket(t)),this.$route.query.code&&!t&&(this.client=await this.$store.dispatch("client/getByCode",this.$route.query.code))}},mounted(){this.searchCode()},watch:{data:{immediate:!0,handler(t){t?this.setData(t):this.setData()}},"$store.state.socket.clientNew"(t){t&&this.setClientFromSocket(t)},"$route.query.code"(t){const s=this.$store.getters["socket/getClietQr"](t);s&&this.setClientFromSocket(s)},async"$store.state.socket.qrRead"(t){this.searchCode()}},components:{InputSearchClient:ut,HistoryClient:kt}},N=t=>(j("data-v-9dde5331"),t=t(),q(),t),Tt={class:"row"},St=N(()=>n("div",{class:"col col-sm-12 col-md-8"},[n("h6",{class:"mt-1"},[n("strong",null,"REGISTRAR INGRESO")])],-1)),Bt={class:"col col-sm-12 col-md-4 text-end"},Ft={class:"row g-3"},xt={class:"col-12"},Rt={class:"col-12"},Nt=N(()=>n("span",{class:"text-danger"},"*",-1)),Lt={class:"col-12 col-sm-6"},Vt=N(()=>n("span",{class:"text-danger"},"*",-1)),Et=["value"],Mt={class:"col-12 col-sm-6"},At=N(()=>n("span",{class:"text-danger"},"*",-1)),Ht={class:"col-12"},jt={class:"col-12 text-end mt-2"},qt={class:"col col-12"};function Ot(t,s,u,w,i,r){const c=a("CIcon"),d=a("CButton"),C=a("CCardHeader"),v=a("InputSearchClient"),b=a("CFormLabel"),h=a("CFormInput"),$=a("CFormFeedback"),k=a("CFormSelect"),f=a("CInputGroupText"),L=a("CInputGroup"),V=a("CFormTextarea"),S=a("CForm"),I=a("CCardBody"),E=a("CCard"),M=a("history-client");return m(),g(F,null,[e(E,null,{default:o(()=>[e(C,null,{default:o(()=>[n("div",Tt,[St,n("div",Bt,[i.client?(m(),D(d,{key:0,color:"info",size:"sm",variant:"outline",onClick:s[0]||(s[0]=_=>i.showModal=!0)},{default:o(()=>[e(c,{icon:"cil-address-book"}),l(" Historial ")]),_:1})):T("",!0)])])]),_:1}),e(I,{class:"p-0"},{default:o(()=>[e(S,{class:tt(["needs-validation p-2 ps-3 pe-3",r.getClass]),novalidate:"",validated:i.validateForm,onSubmit:K(r.Validate,["prevent"]),id:"form-ingreso"},{default:o(()=>[n("div",Ft,[n("div",xt,[e(v,{data:i.client,onSetClient:s[1]||(s[1]=_=>i.client=_)},null,8,["data"])]),n("div",Rt,[e(b,{for:"validateForm",class:"mb-0"},{default:o(()=>[l("Hora "),Nt]),_:1}),e(h,{id:"validateForm",modelValue:i.inputData.time,"onUpdate:modelValue":s[2]||(s[2]=_=>i.inputData.time=_),type:"time",name:"time",required:"",onKeydown:s[3]||(s[3]=et(K(_=>r.changueFocus("minutes"),["prevent"]),["enter"]))},null,8,["modelValue"]),e($,{invalid:""},{default:o(()=>[l(" La hora de ingreso es requerido! ")]),_:1})]),n("div",Lt,[e(b,{for:"validateForm",class:"mb-0"},{default:o(()=>[l("Tiempo "),Vt]),_:1}),e(k,{id:"validateForm",name:"minutes",modelValue:i.inputData.minutes,"onUpdate:modelValue":s[4]||(s[4]=_=>i.inputData.minutes=_)},{default:o(()=>[(m(!0),g(F,null,H(t.list,(_,B)=>(m(),g("option",{key:B,value:_.minutes},p(_.minutes)+" minutos ",9,Et))),128))]),_:1},8,["modelValue"]),e($,{invalid:""},{default:o(()=>[l(" Monto inicial de apertura es requerido! ")]),_:1})]),n("div",Mt,[e(b,{for:"validateForm",class:"mb-0"},{default:o(()=>[l("Consto "),At]),_:1}),e(L,{class:"ms-1 max-md"},{default:o(()=>[e(h,{type:"text",class:"text-center",disabled:"",value:r.getPrice},null,8,["value"]),e(f,null,{default:o(()=>[l(p(i.COIN),1)]),_:1})]),_:1})]),n("div",Ht,[e(b,{for:"validateForm",class:"mb-0"},{default:o(()=>[l("Descripción ")]),_:1}),e(V,{id:"validateForm",modelValue:i.inputData.description,"onUpdate:modelValue":s[5]||(s[5]=_=>i.inputData.description=_),placeholder:"Descripción...",name:"come",rows:"2"},null,8,["modelValue"])])]),n("div",jt,[e(d,{color:"secondary",type:"button",class:"me-2",onClick:s[6]||(s[6]=_=>r.setData())},{default:o(()=>[e(c,{icon:"cil-X"}),l(" Limpiar ")]),_:1}),u.data?(m(),D(d,{key:0,color:"success",type:"button",class:"me-2",onClick:s[7]||(s[7]=_=>r.endData())},{default:o(()=>[e(c,{icon:"cil-check"}),l(" Concluir ")]),_:1})):T("",!0),e(d,{color:"primary",type:"submit"},{default:o(()=>[e(c,{icon:"cil-save"}),l(" "+p(u.data?"Actualizar":"Aceptar"),1)]),_:1})])]),_:1},8,["validated","onSubmit","class"])]),_:1})]),_:1}),n("div",qt,[e(M,{visible:i.showModal,onVisible:s[8]||(s[8]=_=>i.showModal=_),data:i.client},null,8,["visible","data"])])],64)}const zt=R(It,[["render",Ot],["__scopeId","data-v-9dde5331"]]);const Gt={data(){return{intervalId:null,data:null}},emits:["setData"],computed:{...X("register",["list"]),...st("register",["getById"])},async mounted(){this.list.length<=0&&await this.loadData(),this.decrementarTiempo(),this.intervalId=setInterval(()=>{this.decrementarTiempo()},2e3)},beforeUnmount(){clearInterval(this.intervalId)},methods:{...Q("register",["loadData"]),getHours:x,sumHours:it,decrementarTiempo(){console.log("actualizando"),this.list.forEach(t=>{const s=new Date(t.date),w=new Date-s,i=Math.floor(w/(1e3*60));document.getElementById(`time-${t.id}`).innerHTML=i<=-2?`Espera ${i*-1} min`:i<=0&&i>=-1?"0 min":`${i} min`;const r=t.minutes-i,c=document.getElementById(`card-time-${t.id}`);r>=0?(c.classList.contains("bg-danger")&&c.classList.remove("bg-danger"),c.classList.contains("bg-warning")&&c.classList.remove("bg-warning"),r<=1?c.classList.add("bg-warning"):c.classList.add("bg-success")):(c.classList.contains("bg-warning")&&c.classList.remove("bg-warning"),c.classList.add("bg-danger"))})},setItem(t){this.data=this.getById(t.id),this.$emit("setData",this.data)},msgDelete(t){A.fire({title:"¿Desea eliminar el registro?",icon:"question",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#bdbdbd",confirmButtonText:"ELIMINAR",cancelButtonText:"CANCELAR"}).then(async s=>{s.isConfirmed&&await this.$store.dispatch("register/remove",t.id)&&(this.data=null,this.$emit("setData",null))})}},watch:{"$route.path":{immediate:!0,handler(t){t!=="/admin/control-tiempos"&&clearInterval(this.intervalId)}}}},Ut=t=>(j("data-v-9d9b34e3"),t=t(),q(),t),Pt=["id","onClick"],Kt={class:"card-title"},Qt={class:"card-content"},Xt={class:"time"},Jt=["id"],Wt={class:"solicitado"},Yt={class:"date"},Zt=["onClick"],te={key:0,class:"col-12 text-center"},ee=Ut(()=>n("h5",null,"No hay registros",-1)),se=[ee];function oe(t,s,u,w,i,r){const c=a("CIcon");return m(),g(F,null,[(m(!0),g(F,null,H(t.list,(d,C)=>{var v,b;return m(),g("div",{class:"col-12 col-sm-6 col-md-4",key:C},[n("div",{class:"card bg-success",id:`card-time-${d.id}`,onClick:h=>r.setItem(d)},[n("b",Kt,p((v=d.Client)==null?void 0:v.name)+" "+p(((b=d.Client)==null?void 0:b.lastName)||""),1),n("div",Qt,[n("p",Xt,[n("span",{id:`time-${d.id}`},null,8,Jt)]),n("p",Wt," Tiempo: "+p(d.minutes<0?0:d.minutes)+" min ",1),n("p",Yt,[e(c,{icon:"cil-av-timer"}),l(" DE: "),n("b",null,p(r.getHours(new Date(d.date))),1),l(" a "),n("b",null,p(r.sumHours(d.date,d.minutes)),1)]),n("button",{type:"button",class:"btn btn-sm btn-danger text-white",onClick:h=>r.msgDelete(d)},[e(c,{icon:"cil-trash"}),l(" Eliminar ")],8,Zt)])],8,Pt)])}),128)),t.list.length<=0?(m(),g("div",te,se)):T("",!0)],64)}const ne=R(Gt,[["render",oe],["__scopeId","data-v-9d9b34e3"]]),ae={components:{NewIngreso:zt,ListaRegistros:ne,AddVenta:mt},data(){return{data:null,modalVenta:!1}}},ie={class:"row"},le={key:0,class:"col col-12"},ce=n("div",{class:"alert alert-warning",role:"alert"},[n("b",null,"Advertencia!"),l(" Seleccionar caja! ")],-1),re=[ce],de={key:1,class:"col col-12"},ue={class:"alert alert-warning row",role:"alert"},me={class:"col-12 col-sm-8"},_e=n("b",null,"Advertencia!",-1),pe={class:"col-12 col-sm-4 text-end"},he={class:"col col-12 col-sm-8"},Ce={class:"row"},fe=n("div",{class:"col col-sm-6"},[n("h5",{class:"mt-1"},[n("strong",null,"REGISTROS EN CURSO ")])],-1),ge={class:"col col-sm-6 text-end"},ve={class:"row justify-content-md-center"},be={class:"col col-12 col-sm-4"},ye={class:"col col-12"};function we(t,s,u,w,i,r){const c=a("CIcon"),d=a("CButton"),C=a("CCardHeader"),v=a("ListaRegistros"),b=a("CCardBody"),h=a("CCard"),$=a("NewIngreso"),k=a("AddVenta");return m(),g("div",ie,[t.$store.state.caja.caja?T("",!0):(m(),g("div",le,re)),t.$store.state.caja.caja&&!t.$store.state.caja.caja.idOpened?(m(),g("div",de,[n("div",ue,[n("div",me,[e(c,{icon:"cil-warning",height:"20",class:"me-2"}),_e,l(" No se ha efectuado la apertura de caja! ")]),n("div",pe,[e(d,{color:"warning",size:"sm",onClick:s[0]||(s[0]=f=>t.$router.push({name:"apertura"}))},{default:o(()=>[e(c,{icon:"cil-monitor",class:"me-1"}),l(" Aperturar")]),_:1})])])])):T("",!0),n("div",he,[e(h,{class:"mb-4"},{default:o(()=>[e(C,null,{default:o(()=>[n("div",Ce,[fe,n("div",ge,[e(d,{color:"success",variant:"outline",class:"me-1",onClick:s[1]||(s[1]=f=>t.$router.push({name:"sala-juegos"}))},{default:o(()=>[e(c,{icon:"cil-clipboard",class:"me-1"}),l(" Registros")]),_:1}),e(d,{color:"primary",variant:"outline",onClick:s[2]||(s[2]=f=>i.modalVenta=!0)},{default:o(()=>[e(c,{icon:"cil-cart",class:"me-1"}),l(" Vender")]),_:1})])])]),_:1}),e(b,null,{default:o(()=>[n("div",ve,[e(v,{onSetData:s[3]||(s[3]=f=>i.data=f)})])]),_:1})]),_:1})]),n("div",be,[e($,{data:i.data,onSetData:s[4]||(s[4]=f=>i.data=f)},null,8,["data"])]),n("div",ye,[e(k,{visible:i.modalVenta,onVisible:s[5]||(s[5]=f=>i.modalVenta=f)},null,8,["visible"])])])}const Le=R(ae,[["render",we]]);export{Le as default};
