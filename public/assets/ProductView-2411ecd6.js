import{_ as w,r as a,o as p,c as _,t as D,j as S,d as s,a as i,b as c,I as L,P as F,F as B,m as x,K as P,e as A,w as o,Q as I,p as j,v as z,i as M,S as R}from"./index-2006f269.js";import{e as $}from"./input-45862cdb.js";import{i as H}from"./picture-093c9837.js";import{P as K}from"./Paginador-8381f521.js";const O={emits:["setImage"],props:{image:{type:String,required:!1}},data(){return{active:!1,message:null,imageUrl:null}},methods:{openSelect(){document.getElementById("input-drop").click()},handlleDrop(e){e.preventDefault(),!(e.dataTransfer.files.length<=0)&&this.setFile(e.dataTransfer.files[0])},selectFile(e){e.target.files.length<=0||this.setFile(e.target.files[0])},dragover(e){e.preventDefault(),this.active=!0},dragleave(){this.active=!1},remove(){this.imageUrl=null,this.$emit("setImage",null)},setFile(e){const t=e.type;if(["image/jpeg","image/jpg","image/png"].includes(t)){const g=new FileReader;g.onload=()=>{this.imageUrl=g.result},g.readAsDataURL(e),this.$emit("setImage",e)}else this.message="El archivo no es una imagen!"}},watch:{image:{immediate:!0,handler(e){console.log(e),e&&(this.imageUrl=e)}}}},G={key:0,class:"alert alert-warning",role:"alert"},Q={class:"text-center"},J=s("i",{class:"cil-image-plus"},null,-1),W=s("br",null,null,-1),X={key:1,class:"drop-image"},Y=["src"];function Z(e,t,u,g,n,l){const C=a("CIcon"),h=a("Button");return p(),_(B,null,[n.message?(p(),_("div",G,D(n.message),1)):S("",!0),s("div",{class:L(["file-drop",n.active?"active":""]),onDrop:t[4]||(t[4]=F((...r)=>l.handlleDrop&&l.handlleDrop(...r),["prevent"])),onDragover:t[5]||(t[5]=(...r)=>l.dragover&&l.dragover(...r)),onDragleave:t[6]||(t[6]=(...r)=>l.dragleave&&l.dragleave(...r))},[s("input",{type:"file",id:"input-drop",hidden:"",onChange:t[0]||(t[0]=(...r)=>l.selectFile&&l.selectFile(...r))},null,32),n.imageUrl?(p(),_("div",X,[s("img",{src:n.imageUrl,onClick:t[2]||(t[2]=r=>l.openSelect())},null,8,Y),s("p",null,[i(h,{icon:"pi pi-times",onClick:t[3]||(t[3]=r=>l.remove())})])])):(p(),_("div",{key:0,onClick:t[1]||(t[1]=r=>l.openSelect())},[s("b",Q,[J,i(C,{icon:"cil-image-plus",size:"xl"}),W,c(" Arrastre o suelte archivos aquí la imagen ")])]))],34)],64)}const ee=w(O,[["render",Z]]);const te={emits:["visible"],props:{visible:{type:Boolean,default:!1},product:{type:Object,default:null}},data(){return{inputData:{name:null,price:null,description:null,idCategories:null,image:null},imageActual:null,validateForm:null}},computed:{...x("category",["list"])},mounted(){this.list.length<=0&&this.loadData()},methods:{...P("category",["loadData"]),async Validate(e){if(console.log(this.inputData),e.preventDefault(),e.currentTarget.checkValidity()===!1&&(e.preventDefault(),e.stopPropagation()),this.validateForm=!0,!this.inputData.name||!this.inputData.price||!this.inputData.idCategories)return;const u=new FormData;u.append("name",this.inputData.name),u.append("price",this.inputData.price),u.append("idCategories",this.inputData.idCategories),this.inputData.image&&u.append("image",this.inputData.image),this.inputData.description&&u.append("description",this.inputData.description);let g;this.product?g=await this.$store.dispatch("product/update",{id:this.product.id,formData:u}):g=await this.$store.dispatch("product/create",u),g&&this.$emit("visible",!1)},changueFocus(e){const t=$("form-product",e);t&&t.focus()},async setData(e=null){if(this.validateForm=!1,!e){this.inputData={name:null,price:null,description:null,idCategories:null,image:null},Array.isArray(this.list)&&this.list.length>0&&(this.inputData.idCategories=this.list[0].id);return}e!=null&&e.id&&(this.inputData.id=e.id),e!=null&&e.name&&(this.inputData.name=e.name),e!=null&&e.description&&(this.inputData.description=e.description),e.idCategories&&(this.inputData.idCategories=e.idCategories),e.price&&(this.inputData.price=e.price),e.image&&(this.imageActual=this.$store.getters["product/getSrcImage"](e))}},watch:{product:{immediate:!0,handler(e){this.setData(e)}}},components:{DropFile:ee}},ie={class:"row g-3"},se=s("span",{class:"text-danger"},"*",-1),oe=s("span",{class:"text-danger"},"*",-1),ne={class:"form-group"},ae=s("label",{for:"validateForm",class:"mb-0"},[c("Asignar categoria "),s("span",{class:"text-danger"},"*")],-1),le=["value"];function re(e,t,u,g,n,l){const C=a("CModalTitle"),h=a("CModalHeader"),r=a("CFormLabel"),b=a("CFormInput"),v=a("CFormFeedback"),f=a("CCol"),V=a("CFormTextarea"),m=a("DropFile"),k=a("CModalBody"),y=a("CButton"),U=a("CIcon"),E=a("CModalFooter"),T=a("CForm"),q=a("CModal");return p(),A(q,{alignment:"center",visible:u.visible,backdrop:"static",centered:!0,size:"lg",onClose:t[8]||(t[8]=()=>{e.$emit("visible",!1)})},{default:o(()=>[i(T,{class:"needs-validation",novalidate:"",validated:n.validateForm,onSubmit:F(l.Validate,["prevent"]),id:"form-product"},{default:o(()=>[i(h,null,{default:o(()=>[i(C,null,{default:o(()=>[c(D(u.product?"Editr producto":"Agregar producto"),1)]),_:1})]),_:1}),i(k,null,{default:o(()=>[s("div",ie,[i(f,{sm:12,md:6},{default:o(()=>[i(f,{sm:12},{default:o(()=>[i(r,{for:"validateForm",class:"mb-0"},{default:o(()=>[c("Nombre "),se]),_:1}),i(b,{id:"validateForm",modelValue:n.inputData.name,"onUpdate:modelValue":t[0]||(t[0]=d=>n.inputData.name=d),required:"",type:"text",name:"name",onKeydown:t[1]||(t[1]=I(F(d=>l.changueFocus("price"),["prevent"]),["enter"]))},null,8,["modelValue"]),i(v,{invalid:""},{default:o(()=>[c(" El numero de caja es requerido! ")]),_:1})]),_:1}),i(f,{sm:12,class:"mt-2"},{default:o(()=>[i(r,{for:"validateForm",class:"mb-0"},{default:o(()=>[c("Precio "),oe]),_:1}),i(b,{id:"validateForm",modelValue:n.inputData.price,"onUpdate:modelValue":t[2]||(t[2]=d=>n.inputData.price=d),required:"",type:"number",name:"price",onKeydown:t[3]||(t[3]=I(F(d=>l.changueFocus("category"),["prevent"]),["enter"]))},null,8,["modelValue"]),i(v,{invalid:""},{default:o(()=>[c(" El precio del producto es requerido! ")]),_:1})]),_:1}),i(f,{sm:12,class:"mt-2"},{default:o(()=>[s("div",ne,[ae,j(s("select",{class:"form-control",id:"validateForm",required:"",name:"category","onUpdate:modelValue":t[4]||(t[4]=d=>n.inputData.idCategories=d)},[(p(!0),_(B,null,M(e.list,(d,N)=>(p(),_("option",{key:N,value:d.id},D(d.name),9,le))),128))],512),[[z,n.inputData.idCategories]]),i(v,{invalid:""},{default:o(()=>[c(" La categoria del producto es requerido ")]),_:1})])]),_:1}),i(f,{sm:12,class:"mt-2"},{default:o(()=>[i(r,{for:"validateForm",class:"mb-0"},{default:o(()=>[c("Descripcion ")]),_:1}),i(V,{id:"validatedCustom01",modelValue:n.inputData.description,"onUpdate:modelValue":t[5]||(t[5]=d=>n.inputData.description=d),placeholder:"Descripcion del producto...",name:"come",rows:"2"},null,8,["modelValue"])]),_:1})]),_:1}),i(f,{sm:12,md:6,class:"mt-4"},{default:o(()=>[i(m,{image:n.imageActual,onSetImage:t[6]||(t[6]=d=>n.inputData.image=d)},null,8,["image"])]),_:1})])]),_:1}),i(E,null,{default:o(()=>[i(y,{color:"secondary",type:"button",onClick:t[7]||(t[7]=d=>e.$emit("visible",!1))},{default:o(()=>[c(" Cerrar ")]),_:1}),i(y,{color:"primary",type:"submit"},{default:o(()=>[i(U,{icon:"cil-save"}),c(" Guardar ")]),_:1})]),_:1})]),_:1},8,["validated","onSubmit"])]),_:1},8,["visible"])}const de=w(te,[["render",re]]);const ce={components:{AddProduct:de,Paginador:K},data(){return{modalVisible:!1,imageDefault:H,paramsSelected:null,listFilter:[]}},computed:{...x("product",["list","isLoading"])},mounted(){this.list.length<=0&&this.loadData()},methods:{...P("product",["loadData"]),setItem(e){this.modalVisible=!0,this.paramsSelected=e},getPermissions(e){const t=this.$store.getters["auth/getUser"]();return!e.includes(t.rol)},msgDelete(e){R.fire({title:`¿Desea eliminar el producto ${e.name} ${e.lastName||""}?`,icon:"question",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#bdbdbd",confirmButtonText:"ELIMINAR",cancelButtonText:"CANCELAR"}).then(t=>{t.isConfirmed&&this.$store.dispatch("product/remove",e.id)})}}},ue={class:"row"},me={class:"col"},pe={class:"row"},ge=s("div",{class:"col col-sm-6"},[s("h4",{class:"mt-1"},[s("strong",null,"PRODUCTOS")])],-1),_e={class:"col col-sm-6 text-end"},fe={class:"row justify-content-md-center"},Ce={class:"card-product"},he=["src"],ve={class:"card-content"},De={class:"card-title"},be={class:"card-description"},ye={class:"text-end mt-3"},Fe={class:"col col-12"};function Ve(e,t,u,g,n,l){const C=a("CIcon"),h=a("CButton"),r=a("CCardHeader"),b=a("Paginador"),v=a("CCardBody"),f=a("CCard"),V=a("add-product");return p(),_("div",ue,[s("div",me,[i(f,{class:"mb-4"},{default:o(()=>[i(r,null,{default:o(()=>[s("div",pe,[ge,s("div",_e,[l.getPermissions(["admin"])?S("",!0):(p(),A(h,{key:0,color:"primary",size:"md",class:"me-1",onClick:t[0]||(t[0]=m=>{n.modalVisible=!0,n.paramsSelected=null})},{default:o(()=>[i(C,{icon:"cil-plus",class:"me-2"}),c(" Nuevo ")]),_:1}))])])]),_:1}),i(v,null,{default:o(()=>[s("div",fe,[(p(!0),_(B,null,M(e.list,(m,k)=>(p(),_("div",{key:k,class:"col col-12 col-sm-6 col-md-4 col-lg-3"},[s("div",Ce,[s("img",{src:m.image?e.$store.getters["product/getSrcImage"](m):n.imageDefault,class:"card-image"},null,8,he),s("div",ve,[s("h3",De,D(m.name),1),s("p",be,D(m.description),1),s("div",ye,[i(h,{color:"info",size:"sm",disabled:l.getPermissions(["admin"]),class:"me-1",onClick:y=>l.setItem(m)},{default:o(()=>[i(C,{icon:"cil-pencil",class:"me-2"}),c(" Editar ")]),_:2},1032,["disabled","onClick"]),i(h,{color:"danger",size:"sm",disabled:l.getPermissions(["admin"]),class:"me-1",onClick:y=>l.msgDelete(m)},{default:o(()=>[i(C,{icon:"cil-trash",class:"me-2"}),c(" Eliminar ")]),_:2},1032,["disabled","onClick"])])])])]))),128))]),i(b,{list:e.list,elementosPorPagina:10,onSetData:t[1]||(t[1]=m=>n.listFilter=m)},null,8,["list"])]),_:1})]),_:1})]),s("div",Fe,[i(V,{visible:n.modalVisible,onVisible:t[2]||(t[2]=m=>n.modalVisible=m),product:n.paramsSelected},null,8,["visible","product"])])])}const Se=w(ce,[["render",Ve]]);export{Se as default};
