import{_ as B,r as a,o as p,c as _,t as C,j as S,d as s,a as i,b as m,I as L,Q as F,F as I,m as P,K as A,e as M,w as o,T as x,p as j,v as z,i as T,N as R,S as O}from"./index-67878955.js";import{e as $}from"./input-45862cdb.js";import{i as H}from"./picture-093c9837.js";import{P as K}from"./Paginador-d0e0f757.js";const G={emits:["setImage"],props:{image:{type:String,required:!1}},data(){return{active:!1,message:null,imageUrl:null}},methods:{openSelect(){document.getElementById("input-drop").click()},handlleDrop(e){e.preventDefault(),!(e.dataTransfer.files.length<=0)&&this.setFile(e.dataTransfer.files[0])},selectFile(e){e.target.files.length<=0||this.setFile(e.target.files[0])},dragover(e){e.preventDefault(),this.active=!0},dragleave(){this.active=!1},remove(){this.imageUrl=null,this.$emit("setImage",null)},setFile(e){const t=e.type;if(["image/jpeg","image/jpg","image/png"].includes(t)){const g=new FileReader;g.onload=()=>{this.imageUrl=g.result},g.readAsDataURL(e),this.$emit("setImage",e)}else this.message="El archivo no es una imagen!"}},watch:{image:{immediate:!0,handler(e){console.log(e),e&&(this.imageUrl=e)}}}},Q={key:0,class:"alert alert-warning",role:"alert"},J={class:"text-center"},W=s("i",{class:"cil-image-plus"},null,-1),X=s("br",null,null,-1),Y={key:1,class:"drop-image"},Z=["src"];function ee(e,t,u,g,n,l){const h=a("CIcon"),v=a("Button");return p(),_(I,null,[n.message?(p(),_("div",Q,C(n.message),1)):S("",!0),s("div",{class:L(["file-drop",n.active?"active":""]),onDrop:t[4]||(t[4]=F((...r)=>l.handlleDrop&&l.handlleDrop(...r),["prevent"])),onDragover:t[5]||(t[5]=(...r)=>l.dragover&&l.dragover(...r)),onDragleave:t[6]||(t[6]=(...r)=>l.dragleave&&l.dragleave(...r))},[s("input",{type:"file",id:"input-drop",hidden:"",onChange:t[0]||(t[0]=(...r)=>l.selectFile&&l.selectFile(...r))},null,32),n.imageUrl?(p(),_("div",Y,[s("img",{src:n.imageUrl,onClick:t[2]||(t[2]=r=>l.openSelect())},null,8,Z),s("p",null,[i(v,{icon:"pi pi-times",onClick:t[3]||(t[3]=r=>l.remove())})])])):(p(),_("div",{key:0,onClick:t[1]||(t[1]=r=>l.openSelect())},[s("b",J,[W,i(h,{icon:"cil-image-plus",size:"xl"}),X,m(" Arrastre o suelte archivos aquí la imagen ")])]))],34)],64)}const te=B(G,[["render",ee]]);const ie={emits:["visible"],props:{visible:{type:Boolean,default:!1},product:{type:Object,default:null}},data(){return{inputData:{name:null,price:null,description:null,idCategories:null,image:null},imageActual:null,validateForm:null}},computed:{...P("category",["list"])},mounted(){this.list.length<=0&&this.loadData()},methods:{...A("category",["loadData"]),async Validate(e){if(console.log(this.inputData),e.preventDefault(),e.currentTarget.checkValidity()===!1&&(e.preventDefault(),e.stopPropagation()),this.validateForm=!0,!this.inputData.name||!this.inputData.price||!this.inputData.idCategories)return;const u=new FormData;u.append("name",this.inputData.name),u.append("price",this.inputData.price),u.append("idCategories",this.inputData.idCategories),this.inputData.image&&u.append("image",this.inputData.image),this.inputData.description&&u.append("description",this.inputData.description);let g;this.product?g=await this.$store.dispatch("product/update",{id:this.product.id,formData:u}):g=await this.$store.dispatch("product/create",u),g&&this.$emit("visible",!1)},changueFocus(e){const t=$("form-product",e);t&&t.focus()},async setData(e=null){if(this.validateForm=!1,!e){this.inputData={name:null,price:null,description:null,idCategories:null,image:null},Array.isArray(this.list)&&this.list.length>0&&(this.inputData.idCategories=this.list[0].id);return}e!=null&&e.id&&(this.inputData.id=e.id),e!=null&&e.name&&(this.inputData.name=e.name),e!=null&&e.description&&(this.inputData.description=e.description),e.idCategories&&(this.inputData.idCategories=e.idCategories),e.price&&(this.inputData.price=e.price),e.image&&(this.imageActual=this.$store.getters["product/getSrcImage"](e))}},watch:{product:{immediate:!0,handler(e){this.setData(e)}}},components:{DropFile:te}},se={class:"row g-3"},oe=s("span",{class:"text-danger"},"*",-1),ne=s("span",{class:"text-danger"},"*",-1),ae={class:"form-group"},le=s("label",{for:"validateForm",class:"mb-0"},[m("Asignar categoria "),s("span",{class:"text-danger"},"*")],-1),re=["value"];function de(e,t,u,g,n,l){const h=a("CModalTitle"),v=a("CModalHeader"),r=a("CFormLabel"),b=a("CFormInput"),D=a("CFormFeedback"),f=a("CCol"),V=a("CFormTextarea"),k=a("DropFile"),d=a("CModalBody"),y=a("CButton"),w=a("CIcon"),U=a("CModalFooter"),N=a("CForm"),E=a("CModal");return p(),M(E,{alignment:"center",visible:u.visible,backdrop:"static",centered:!0,size:"lg",onClose:t[8]||(t[8]=()=>{e.$emit("visible",!1)})},{default:o(()=>[i(N,{class:"needs-validation",novalidate:"",validated:n.validateForm,onSubmit:F(l.Validate,["prevent"]),id:"form-product"},{default:o(()=>[i(v,null,{default:o(()=>[i(h,null,{default:o(()=>[m(C(u.product?"Editr producto":"Agregar producto"),1)]),_:1})]),_:1}),i(d,null,{default:o(()=>[s("div",se,[i(f,{sm:12,md:6},{default:o(()=>[i(f,{sm:12},{default:o(()=>[i(r,{for:"validateForm",class:"mb-0"},{default:o(()=>[m("Nombre "),oe]),_:1}),i(b,{id:"validateForm",modelValue:n.inputData.name,"onUpdate:modelValue":t[0]||(t[0]=c=>n.inputData.name=c),required:"",type:"text",name:"name",onKeydown:t[1]||(t[1]=x(F(c=>l.changueFocus("price"),["prevent"]),["enter"]))},null,8,["modelValue"]),i(D,{invalid:""},{default:o(()=>[m(" El numero de caja es requerido! ")]),_:1})]),_:1}),i(f,{sm:12,class:"mt-2"},{default:o(()=>[i(r,{for:"validateForm",class:"mb-0"},{default:o(()=>[m("Precio "),ne]),_:1}),i(b,{id:"validateForm",modelValue:n.inputData.price,"onUpdate:modelValue":t[2]||(t[2]=c=>n.inputData.price=c),required:"",type:"number",name:"price",onKeydown:t[3]||(t[3]=x(F(c=>l.changueFocus("category"),["prevent"]),["enter"]))},null,8,["modelValue"]),i(D,{invalid:""},{default:o(()=>[m(" El precio del producto es requerido! ")]),_:1})]),_:1}),i(f,{sm:12,class:"mt-2"},{default:o(()=>[s("div",ae,[le,j(s("select",{class:"form-control",id:"validateForm",required:"",name:"category","onUpdate:modelValue":t[4]||(t[4]=c=>n.inputData.idCategories=c)},[(p(!0),_(I,null,T(e.list,(c,q)=>(p(),_("option",{key:q,value:c.id},C(c.name),9,re))),128))],512),[[z,n.inputData.idCategories]]),i(D,{invalid:""},{default:o(()=>[m(" La categoria del producto es requerido ")]),_:1})])]),_:1}),i(f,{sm:12,class:"mt-2"},{default:o(()=>[i(r,{for:"validateForm",class:"mb-0"},{default:o(()=>[m("Descripcion ")]),_:1}),i(V,{id:"validatedCustom01",modelValue:n.inputData.description,"onUpdate:modelValue":t[5]||(t[5]=c=>n.inputData.description=c),placeholder:"Descripcion del producto...",name:"come",rows:"2"},null,8,["modelValue"])]),_:1})]),_:1}),i(f,{sm:12,md:6,class:"mt-4"},{default:o(()=>[i(k,{image:n.imageActual,onSetImage:t[6]||(t[6]=c=>n.inputData.image=c)},null,8,["image"])]),_:1})])]),_:1}),i(U,null,{default:o(()=>[i(y,{color:"secondary",type:"button",onClick:t[7]||(t[7]=c=>e.$emit("visible",!1))},{default:o(()=>[m(" Cerrar ")]),_:1}),i(y,{color:"primary",type:"submit"},{default:o(()=>[i(w,{icon:"cil-save"}),m(" Guardar ")]),_:1})]),_:1})]),_:1},8,["validated","onSubmit"])]),_:1},8,["visible"])}const ce=B(ie,[["render",de]]),ue={components:{AddProduct:ce,Paginador:K},data(){return{modalVisible:!1,imageDefault:H,paramsSelected:null,listFilter:[],COIN:R}},computed:{...P("product",["list","isLoading"])},mounted(){this.list.length<=0&&this.loadData()},methods:{...A("product",["loadData"]),setItem(e){this.modalVisible=!0,this.paramsSelected=e},getPermissions(e){const t=this.$store.getters["auth/getUser"]();return!e.includes(t.rol)},msgDelete(e){O.fire({title:`¿Desea eliminar el producto ${e.name} ${e.lastName||""}?`,icon:"question",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#bdbdbd",confirmButtonText:"ELIMINAR",cancelButtonText:"CANCELAR"}).then(t=>{t.isConfirmed&&this.$store.dispatch("product/remove",e.id)})}}},me={class:"row"},pe={class:"col"},ge={class:"row"},_e=s("div",{class:"col col-sm-6"},[s("h4",{class:"mt-1"},[s("strong",null,"PRODUCTOS")])],-1),fe={class:"col col-sm-6 text-end"},Ce={class:"row justify-content-md-center"},he={class:"card-product"},ve=["src"],De={class:"card-content"},be={class:"card-title mb-0"},ye={class:"d-flex justify-content-between align-items-center"},Fe={class:"text-secondary"},Ve={class:"card-description"},ke={class:"text-end mt-3"},we={class:"col col-12"};function Be(e,t,u,g,n,l){const h=a("CIcon"),v=a("CButton"),r=a("CCardHeader"),b=a("CBadge"),D=a("Paginador"),f=a("CCardBody"),V=a("CCard"),k=a("add-product");return p(),_("div",me,[s("div",pe,[i(V,{class:"mb-4"},{default:o(()=>[i(r,null,{default:o(()=>[s("div",ge,[_e,s("div",fe,[l.getPermissions(["admin"])?S("",!0):(p(),M(v,{key:0,color:"primary",size:"md",class:"me-1",onClick:t[0]||(t[0]=d=>{n.modalVisible=!0,n.paramsSelected=null})},{default:o(()=>[i(h,{icon:"cil-plus",class:"me-2"}),m(" Nuevo ")]),_:1}))])])]),_:1}),i(f,null,{default:o(()=>[s("div",Ce,[(p(!0),_(I,null,T(e.list,(d,y)=>(p(),_("div",{key:y,class:"col col-12 col-sm-6 col-md-4 col-lg-3"},[s("div",he,[s("img",{src:d.image?e.$store.getters["product/getSrcImage"](d):n.imageDefault,class:"card-image"},null,8,ve),s("div",De,[s("h3",be,C(d.name),1),s("div",ye,[s("span",Fe,C(d.Category.name),1),i(b,{color:"success",shape:"rounded-pill",style:{"font-size":"15px"}},{default:o(()=>[m(C(d.price)+" "+C(n.COIN),1)]),_:2},1024)]),s("p",Ve,C(d.description),1),s("div",ke,[i(v,{color:"info",size:"sm",disabled:l.getPermissions(["admin"]),class:"me-1",onClick:w=>l.setItem(d)},{default:o(()=>[i(h,{icon:"cil-pencil"})]),_:2},1032,["disabled","onClick"]),i(v,{color:"danger",size:"sm",disabled:l.getPermissions(["admin"]),class:"me-1",onClick:w=>l.msgDelete(d)},{default:o(()=>[i(h,{icon:"cil-trash"})]),_:2},1032,["disabled","onClick"])])])])]))),128))]),i(D,{list:e.list,elementosPorPagina:10,onSetData:t[1]||(t[1]=d=>n.listFilter=d)},null,8,["list"])]),_:1})]),_:1})]),s("div",we,[i(k,{visible:n.modalVisible,onVisible:t[2]||(t[2]=d=>n.modalVisible=d),product:n.paramsSelected},null,8,["visible","product"])])])}const Ae=B(ue,[["render",Be]]);export{Ae as default};
