import{_ as y,N as x,l as q,K as j,r as i,c as A,d as a,b as u,t as d,a as t,w as l,Q as f,o as C,T as I,j as N}from"./index-0487b031.js";import{e as g,b as F,c as U}from"./format-date-ea6389fa.js";import{e as O}from"./input-45862cdb.js";const T={data(){return{validForm:null,valInput:{date:g(new Date),startAmount:0,amount:0,writeAmount:0,comment:null,time:F(new Date)},COIN:x,dateApertura:null}},computed:{...q("caja",["getCaja"]),getDisabled(){const r=this.$store.state.caja.caja;return!(r&&r.idOpened)},getDifferenceAmount(){return this.valInput.writeAmount-this.valInput.amount}},methods:{convertDate:U,...j("arqueo",["movement"]),async initData(){const r=this.getCaja;if(!r)return;const e=this.$store.getters["arqueo/getApertura"](r.id);if(!e){this.valInput={date:g(new Date),startAmount:0,amount:0,writeAmount:0,comment:null,time:F(new Date)};return}if(e){this.valInput.startAmount=e.startAmount,this.dateApertura=e.date;const{total:_}=await this.movement();this.valInput.amount=this.valInput.startAmount+(_||0),this.valInput.writeAmount=this.valInput.amount,this.valInput.differenceAmount=this.valInput.writeAmount-this.valInput.amount,this.changueFocus("writeAmount")}},async Validate(){event.currentTarget.checkValidity()===!1&&(event.preventDefault(),event.stopPropagation()),this.validForm=!0,this.valInput.date&&this.valInput.amount!==null&&this.valInput.writeAmount!==null&&await this.$store.dispatch("arqueo/cerrarCaja",{date:new Date(this.valInput.date+" "+this.valInput.time),endAmount:this.valInput.amount,expected:this.valInput.writeAmount,comment:this.valInput.comment})},changueFocus(r){const e=O("form-cerrar-caja",r);e&&e.focus()}},watch:{"$store.state.caja.caja":{immediate:!0,handler(r){this.initData()}},"$store.state.arqueo.listApertura":{immediate:!0,handler(r){this.initData()}}}},k={class:"col-12"},B={class:"col-12 col-sm-4"},G=a("span",{class:"text-danger"},"*",-1),M={class:"col-12 col-sm-4"},K=a("span",{class:"text-danger"},"*",-1),R={class:"col-12 col-sm-4"},H=a("span",{class:"text-danger"},"*",-1),S={class:"col-12 col-sm-4"},E=a("span",{class:"text-danger"},"*",-1),L={class:"col-12 col-sm-4"},J=a("span",{class:"text-danger"},"*",-1),P={class:"col-12 col-sm-4"},Q=a("span",{class:"text-danger"},"*",-1),z={class:"col-12 col-sm-12"},W={key:0,class:"col col-12"},X={class:"alert alert-danger mb-0",role:"alert"},Y={class:"col-12 col-sm-12 text-end"};function Z(r,e,_,$,n,o){const m=i("CFormLabel"),c=i("CFormInput"),b=i("CFormFeedback"),p=i("CInputGroupText"),v=i("CInputGroup"),w=i("CFormTextarea"),h=i("CIcon"),D=i("CButton"),V=i("CForm");return C(),A("div",k,[a("p",null,[u(" Ultima apertura: "),a("b",null,d(o.convertDate(n.dateApertura)),1)]),t(V,{class:"row g-3 needs-validation",novalidate:"",validated:n.validForm,onSubmit:f(o.Validate,["prevent"]),id:"form-cerrar-caja"},{default:l(()=>[a("div",B,[t(m,{for:"validForm",class:"mb-0"},{default:l(()=>[u("Fecha "),G]),_:1}),t(c,{id:"validForm",modelValue:n.valInput.date,"onUpdate:modelValue":e[0]||(e[0]=s=>n.valInput.date=s),type:"date",name:"date",disabled:o.getDisabled,required:"",onKeydown:e[1]||(e[1]=I(f(s=>o.changueFocus("time"),["prevent"]),["enter"]))},null,8,["modelValue","disabled"]),t(b,{invalid:""},{default:l(()=>[u(" Fecha de apertura es requerido! ")]),_:1})]),a("div",M,[t(m,{for:"validatedCustom01",class:"mb-0"},{default:l(()=>[u("Hora "),K]),_:1}),t(c,{id:"validatedCustom01",modelValue:n.valInput.time,"onUpdate:modelValue":e[2]||(e[2]=s=>n.valInput.time=s),type:"time",name:"time",disabled:o.getDisabled,required:"",onKeydown:e[3]||(e[3]=I(f(s=>o.changueFocus("writeAmount"),["prevent"]),["enter"]))},null,8,["modelValue","disabled"]),t(b,{invalid:""},{default:l(()=>[u(" Hora de apertura es requerido! ")]),_:1})]),a("div",R,[t(m,{for:"validForm",class:"mb-0"},{default:l(()=>[u("Monto Inicial"),H]),_:1}),t(v,{class:"mb-3"},{default:l(()=>[t(c,{id:"validForm",required:"",type:"number",modelValue:n.valInput.startAmount,"onUpdate:modelValue":e[4]||(e[4]=s=>n.valInput.startAmount=s),disabled:!0,name:"startAmount"},null,8,["modelValue"]),t(p,null,{default:l(()=>[a("b",null,d(n.COIN),1)]),_:1})]),_:1})]),a("div",S,[t(m,{for:"validForm",class:"mb-0"},{default:l(()=>[u("Monto Final"),E]),_:1}),t(v,{class:"mb-3"},{default:l(()=>[t(c,{id:"validForm",required:"",type:"number",modelValue:n.valInput.amount,"onUpdate:modelValue":e[5]||(e[5]=s=>n.valInput.amount=s),disabled:!0,name:"amount"},null,8,["modelValue"]),t(p,null,{default:l(()=>[a("b",null,d(n.COIN),1)]),_:1})]),_:1})]),a("div",L,[t(m,{for:"validForm",class:"mb-0"},{default:l(()=>[u("Anotar Monto "),J]),_:1}),t(v,{class:"mb-3"},{default:l(()=>[t(c,{id:"validForm",required:"",type:"number",modelValue:n.valInput.writeAmount,"onUpdate:modelValue":e[6]||(e[6]=s=>n.valInput.writeAmount=s),name:"writeAmount",disabled:o.getDisabled,onKeydown:e[7]||(e[7]=I(f(s=>o.changueFocus("comment"),["prevent"]),["enter"]))},null,8,["modelValue","disabled"]),t(p,null,{default:l(()=>[a("b",null,d(n.COIN),1)]),_:1})]),_:1}),t(b,{invalid:""},{default:l(()=>[u(" Monto inicial de apertura es requerido! ")]),_:1})]),a("div",P,[t(m,{for:"validForm",class:"mb-0"},{default:l(()=>[u("Diferencia "),Q]),_:1}),t(v,{class:"mb-3"},{default:l(()=>[t(c,{id:"validForm",required:"",type:"number",disabled:"true",modelValue:o.getDifferenceAmount,"onUpdate:modelValue":e[8]||(e[8]=s=>o.getDifferenceAmount=s),name:"differenceAmount"},null,8,["modelValue"]),t(p,null,{default:l(()=>[a("b",null,d(n.COIN),1)]),_:1})]),_:1})]),a("div",z,[t(w,{id:"validForm",label:"Comentario",disabled:o.getDisabled,modelValue:n.valInput.comment,"onUpdate:modelValue":e[9]||(e[9]=s=>n.valInput.comment=s),placeholder:"Comentario...",name:"comment",rows:"2"},null,8,["disabled","modelValue"])]),o.getDifferenceAmount!==0?(C(),A("div",W,[a("div",X,[t(h,{icon:"cil-warning",class:"me-2"}),u(" Â¡Hay una diferencia de "),a("b",null,d(o.getDifferenceAmount<0?o.getDifferenceAmount*-1:o.getDifferenceAmount)+" "+d(n.COIN)+" "+d(o.getDifferenceAmount>0?"que sobran":"que faltan")+"!",1)])])):N("",!0),a("div",Y,[t(D,{color:"primary",type:"submit",class:"ms-2",disabled:o.getDisabled},{default:l(()=>[t(h,{icon:"cil-save"}),u(" "+d(r.$route.params.code?"GUARDAR CAMBIOS":"CERRAR CAJA"),1)]),_:1},8,["disabled"])])]),_:1},8,["validated","onSubmit"])])}const ne=y(T,[["render",Z]]);export{ne as default};
